# SNES HiROM Linker Configuration
# For use with ca65/ld65
#
# HiROM Memory Map:
#   Banks $40-$7D: ROM at $0000-$FFFF (64KB per bank)
#   Banks $00-$3F: ROM mirrors at $8000-$FFFF
#   Banks $00-$3F: RAM at $0000-$1FFF (8KB mirrored)
#   Banks $7E-$7F: Work RAM (128KB)
#
# Key differences from LoROM:
#   - ROM mapped at $0000-$FFFF (full 64KB per bank)
#   - Vectors at $FFE0 in bank $00 mirror bank $40
#   - Header byte $FFD5 = $21 (HiROM flag)
#
# This configuration supports ROMs up to 64KB (single bank).
# For larger ROMs, extend with additional banks.

MEMORY {
    # Zero Page ($00-$FF) - Direct Page addressing
    ZP:      start = $00,    size = $100,   type = rw;

    # Low RAM ($0100-$1FFF) - Stack and general RAM
    LORAM:   start = $0100,  size = $1F00,  type = rw;

    # ROM Bank 0 ($C000-$FFAF) - Code and data
    # In HiROM, bank $00:$8000-$FFFF mirrors bank $40:$8000-$FFFF
    # We use $C000 start for a typical HiROM layout
    # This gives 16KB for code/data before header
    ROM:     start = $C000,  size = $3FB0,  type = ro, file = %O, fill = yes;

    # SNES Internal Header ($FFB0-$FFDF)
    HEADER:  start = $FFB0,  size = $30,    type = ro, file = %O, fill = yes;

    # Interrupt Vectors ($FFE0-$FFFF)
    VECTORS: start = $FFE0,  size = $20,    type = ro, file = %O, fill = yes;
}

SEGMENTS {
    # Zero page variables
    ZEROPAGE: load = ZP,      type = zp;

    # BSS (uninitialized data in RAM)
    BSS:      load = LORAM,   type = bss;

    # Startup code
    STARTUP:  load = ROM,     type = ro,  align = $100;

    # Main code segment
    CODE:     load = ROM,     type = ro;

    # Read-only data
    RODATA:   load = ROM,     type = ro;

    # Initialized data
    DATA:     load = ROM,     type = ro;

    # SNES ROM header
    HEADER:   load = HEADER,  type = ro;

    # Interrupt vectors
    VECTORS:  load = VECTORS, type = ro;
}

SYMBOLS {
    __STACK_START__: type = export, value = $1FFF;
}
